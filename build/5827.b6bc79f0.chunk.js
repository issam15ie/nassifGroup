"use strict";(self.webpackChunknassif_group_strapi=self.webpackChunknassif_group_strapi||[]).push([[5827],{12038:(S,E,s)=>{s.d(E,{u:()=>T});var t=s(21272),a=s(56445),m=s(54894),M=s(74930);const T=(v={},_={})=>{const{id:c="",...A}=v,{get:R}=(0,a.ry)(),{locale:f}=(0,m.A)(),L=(0,a.QM)(f,{sensitivity:"base"}),{data:r,error:P,isError:U,isLoading:W,refetch:u}=(0,M.useQuery)(["roles",c,A],async()=>{const{data:l}=await R(`/admin/roles/${c??""}`,{params:A});return l},_);return{roles:t.useMemo(()=>{let l=[];return r&&(Array.isArray(r.data)?l=r.data:l=[r.data]),[...l].sort((C,K)=>L.compare(C.name,K.name))},[r,L]),error:P,isError:U,isLoading:W,refetch:u}}},25827:(S,E,s)=>{s.r(E),s.d(E,{default:()=>V});var t=s(92132),a=s(56445),m=s(82437),M=s(17703),T=s(97927),v=s(21272),_=s(94061),c=s(85963),A=s(90151),R=s(68074),f=s(4198),L=s(55356),r=s(38413),P=s(83997),U=s(7537),W=s(5287),u=s(30893),F=s(46270),l=s(61535),C=s(54894),K=s(12038),j=s(60740),D=s(33544),N=s(12083),as=s(74930),es=s(55151),ns=s(79077),is=s(59057),os=s(15126),_s=s(63299),ds=s(67014),rs=s(59080),ls=s(79275),Es=s(14718),Ms=s(5790),Ps=s(41286),Ds=s(35223),Os=s(5409),ms=s(2600),cs=s(48940),hs=s(51187),gs=s(412),vs=s(77965),As=s(45635),Rs=s(94710),Ls=s(39404),us=s(36676),Cs=s(57505);const p=({disabled:d,role:e,values:i,errors:o,onChange:B,onBlur:h})=>{const{formatMessage:n}=(0,C.A)();return(0,t.jsx)(_.a,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsxs)(P.s,{direction:"column",alignItems:"stretch",gap:4,children:[(0,t.jsxs)(P.s,{justifyContent:"space-between",children:[(0,t.jsxs)(_.a,{children:[(0,t.jsx)(_.a,{children:(0,t.jsx)(u.o,{fontWeight:"bold",children:e?e.name:n({id:"global.details",defaultMessage:"Details"})})}),(0,t.jsx)(_.a,{children:(0,t.jsx)(u.o,{textColor:"neutral500",variant:"pi",children:e?e.description:n({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})})})]}),(0,t.jsx)(c.$,{disabled:!0,variant:"secondary",children:n({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:e.usersCount})})]}),(0,t.jsxs)(A.x,{gap:4,children:[(0,t.jsx)(R.E,{col:6,children:(0,t.jsx)(U.k,{disabled:d,name:"name",error:o.name&&n({id:o.name}),label:n({id:"global.name",defaultMessage:"Name"}),onChange:B,onBlur:h,required:!0,value:i.name||""})}),(0,t.jsx)(R.E,{col:6,children:(0,t.jsx)(W.T,{disabled:d,label:n({id:"global.description",defaultMessage:"Description"}),id:"description",error:o.name&&n({id:o.name}),onChange:B,onBlur:h,children:i.description||""})})]})]})})};p.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},p.propTypes={disabled:D.bool,errors:D.object.isRequired,onBlur:D.func.isRequired,onChange:D.func.isRequired,role:D.object,values:D.object};const Q=N.Ik().shape({name:N.Yj().required(a.iW.required)}),H=()=>{const d=(0,a.hN)(),{formatMessage:e}=(0,C.A)(),{params:{id:i}}=(0,M.W5)("/settings/roles/:id"),{put:o}=(0,a.ry)(),[B,h]=(0,v.useState)(!1),n=(0,v.useRef)(),{lockApp:Y,unlockApp:Z}=(0,a.MA)(),{trackUsage:G}=(0,a.z1)(),{formatAPIError:J}=(0,a.wq)(),{isLoading:X,data:b}=(0,j.u)(i,{cacheTime:0}),{roles:[O={}],isLoading:x,refetch:w}=(0,K.u)({id:i},{cacheTime:0}),{permissions:k,isLoading:$}=(0,j.a)({id:i},{cacheTime:0}),q=async I=>{try{Y(),h(!0);const{permissionsToSend:g,didUpdateConditions:y}=n.current.getPermissions();await o(`/admin/roles/${i}`,I),O.code!=="strapi-super-admin"&&(await o(`/admin/roles/${i}/permissions`,{permissions:g}),y&&G("didUpdateConditions")),n.current.setFormAfterSubmit(),await w(),d({type:"success",message:{id:"notification.success.saved"}})}catch(g){d({type:"warning",message:J(g)})}finally{h(!1),Z()}},z=!x&&O.code==="strapi-super-admin";return(0,t.jsxs)(r.g,{children:[(0,t.jsx)(a.x7,{name:"Roles"}),(0,t.jsx)(l.l1,{enableReinitialize:!0,initialValues:{name:O.name,description:O.description},onSubmit:q,validationSchema:Q,validateOnChange:!1,children:({handleSubmit:I,values:g,errors:y,handleChange:ss,handleBlur:ts})=>(0,t.jsxs)("form",{onSubmit:I,children:[(0,t.jsx)(L.Q,{primaryAction:(0,t.jsx)(P.s,{gap:2,children:(0,t.jsx)(c.$,{disabled:O.code==="strapi-super-admin",onClick:I,loading:B,size:"L",children:e({id:"global.save",defaultMessage:"Save"})})}),title:e({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:e({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:(0,t.jsx)(a.N_,{startIcon:(0,t.jsx)(F.A,{}),to:"/settings/roles",children:e({id:"global.back",defaultMessage:"Back"})})}),(0,t.jsx)(f.s,{children:(0,t.jsxs)(P.s,{direction:"column",alignItems:"stretch",gap:6,children:[(0,t.jsx)(p,{isLoading:x||$,disabled:z,errors:y,values:g,onChange:ss,onBlur:ts,role:O}),!X&&!x&&!$?(0,t.jsx)(_.a,{shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(j.P,{isFormDisabled:z,permissions:k,ref:n,layout:b})}):(0,t.jsx)(_.a,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(a.Bl,{})})]})})]})})]})},V=()=>{const d=(0,m.d4)(T.s),{isLoading:e,allowedActions:{canRead:i,canUpdate:o}}=(0,a.ec)({read:d.settings.roles.read,update:d.settings.roles.update});return e?(0,t.jsx)(a.Bl,{}):!i&&!o?(0,t.jsx)(M.rd,{to:"/"}):(0,t.jsx)(H,{})}},46270:(S,E,s)=>{s.d(E,{A:()=>m});var t=s(92132);const a=M=>(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...M,children:(0,t.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),m=a}}]);
