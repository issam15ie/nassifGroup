"use strict";(self.webpackChunknassif_group_strapi=self.webpackChunknassif_group_strapi||[]).push([[4361],{34361:(Q,O,e)=>{e.r(O),e.d(O,{default:()=>y});var s=e(92132),a=e(56445),U=e(82437),I=e(97927),p=e(21272),K=e(4198),g=e(55356),P=e(38413),i=e(5194),t=e(5409),R=e(54894),h=e(74930),j=e(17703),A=e(58593),k=e(84977),b=e(55151),G=e(79077),S=e(59057),J=e(15126),X=e(63299),C=e(67014),N=e(59080),V=e(79275),B=e(14718),W=e(61535),n=e(5790),d=e(12083),T=e(41286),D=e(35223),M=e(2600),_=e(48940),l=e(51187);const m=[{name:"name",key:"name",metadatas:{label:{id:"Settings.tokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.tokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.tokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],f=()=>{(0,a.L4)();const{formatMessage:c}=(0,R.A)(),u=(0,a.hN)(),$=(0,U.d4)(I.s),{allowedActions:{canCreate:L,canDelete:z,canUpdate:o,canRead:E}}=(0,a.ec)($.settings["transfer-tokens"]),{push:v}=(0,j.W6)(),{trackUsage:F}=(0,a.z1)(),{startSection:q}=(0,a.Cx)(),Z=(0,p.useRef)(q),{get:ee,del:se}=(0,a.ry)();(0,p.useEffect)(()=>{Z.current&&Z.current("transferTokens")},[]),(0,p.useEffect)(()=>{v({search:t.stringify({sort:"name:ASC"},{encode:!1})})},[v]);const te=m.map(r=>({...r,metadatas:{...r.metadatas,label:c(r.metadatas.label)}})),{data:x,status:Y,isFetching:ne,refetch:ae}=(0,h.useQuery)(["transfer-tokens"],async()=>{F("willAccessTokenList",{tokenType:A.T});const{data:{data:r}}=await ee("/admin/transfer/tokens");return F("didAccessTokenList",{number:r.length,tokenType:A.T}),r},{enabled:E,onError(r){r?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?u({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):u({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),w=E&&(Y!=="success"&&Y!=="error"||Y==="success"&&ne),oe=(0,h.useMutation)(async r=>{await se(`/admin/transfer/tokens/${r}`)},{async onSuccess(){await ae(["transfer-tokens"])},onError(r){r?.response?.data?.data?u({type:"warning",message:r.response.data.data}):r?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?u({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):u({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),H=x&&x?.length>0,re=E&&H,ie=E&&!H&&!L,de=E&&!H&&L;return(0,s.jsxs)(P.g,{"aria-busy":w,children:[(0,s.jsx)(a.x7,{name:"Transfer Tokens"}),(0,s.jsx)(g.Q,{title:c({id:"Settings.transferTokens.title",defaultMessage:"Transfer Tokens"}),subtitle:c({id:"Settings.transferTokens.description",defaultMessage:'"List of generated transfer tokens"'}),primaryAction:L?(0,s.jsx)(a.z9,{"data-testid":"create-transfer-token-button",startIcon:(0,s.jsx)(i.A,{}),size:"S",onClick:()=>F("willAddTokenFromList",{tokenType:A.T}),to:"/settings/transfer-tokens/create",children:c({id:"Settings.transferTokens.create",defaultMessage:"Create new Transfer Token"})}):void 0}),(0,s.jsxs)(K.s,{children:[!E&&(0,s.jsx)(a.UW,{}),re&&(0,s.jsx)(k.T,{permissions:{canRead:E,canDelete:z,canUpdate:o},headers:te,contentType:"trasfer-tokens",rows:x,isLoading:w,onConfirmDelete:r=>oe.mutateAsync(r),tokens:x,tokenType:A.T}),de&&(0,s.jsx)(a.R1,{content:{id:"Settings.transferTokens.addFirstToken",defaultMessage:"Add your first Transfer Token"},action:(0,s.jsx)(a.z9,{variant:"secondary",startIcon:(0,s.jsx)(i.A,{}),to:"/settings/transfer-tokens/create",children:c({id:"Settings.transferTokens.addNewToken",defaultMessage:"Add new Transfer Token"})})}),ie&&(0,s.jsx)(a.R1,{content:{id:"Settings.transferTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})]})]})},y=()=>{const c=(0,U.d4)(I.s);return(0,s.jsx)(a.kz,{permissions:c.settings["transfer-tokens"].main,children:(0,s.jsx)(f,{})})}},58593:(Q,O,e)=>{e.d(O,{A:()=>s,T:()=>a});const s="api-token",a="transfer-token"},84977:(Q,O,e)=>{e.d(O,{T:()=>B});var s=e(92132),a=e(94061),U=e(88353),I=e(83997),p=e(25641),K=e(90361),g=e(33363),P=e(30893),i=e(56445),t=e(33544),R=e(54894),h=e(17703),j=e(21272),A=e(83925),k=e(41909),b=e(50612),G=e(94929);const S=({tokenName:n,onClickDelete:d,tokenType:T})=>{const{formatMessage:D}=(0,R.A)(),{trackUsage:M}=(0,i.z1)(),[_,l]=(0,j.useState)(!1),m=()=>{l(!1),M("willDeleteToken",{tokenType:T}),d()};return(0,s.jsxs)(a.a,{paddingLeft:1,onClick:f=>f.stopPropagation(),children:[(0,s.jsx)(U.K,{onClick:()=>{l(!0)},label:D({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${n}`}),name:"delete",noBorder:!0,icon:(0,s.jsx)(b.A,{})}),(0,s.jsx)(i.TM,{onToggleDialog:()=>l(!1),onConfirm:m,isOpen:_})]})};S.propTypes={tokenName:t.string.isRequired,onClickDelete:t.func.isRequired,tokenType:t.string.isRequired};const J={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},X=(0,G.Ay)(i.N_)`
  svg {
    path {
      fill: ${({theme:n})=>n.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:n})=>n.colors.neutral800};
      }
    }
  }
`,C=({tokenName:n,tokenId:d,buttonType:T,children:D})=>{const{formatMessage:M}=(0,R.A)(),{location:{pathname:_}}=(0,h.W6)();return(0,s.jsx)(X,{to:`${_}/${d}`,title:M(J[T],{target:n}),children:D})};C.propTypes={tokenName:t.string.isRequired,tokenId:t.oneOfType([t.string,t.number]).isRequired,buttonType:t.string,children:t.node.isRequired},C.defaultProps={buttonType:"edit"};const N=({tokenName:n,tokenId:d})=>(0,s.jsx)(C,{tokenName:n,tokenId:d,buttonType:"read",children:(0,s.jsx)(A.A,{})});N.propTypes={tokenName:t.string.isRequired,tokenId:t.oneOfType([t.string,t.number]).isRequired};const V=({tokenName:n,tokenId:d})=>(0,s.jsx)(C,{tokenName:n,tokenId:d,children:(0,s.jsx)(k.A,{})});V.propTypes={tokenName:t.string.isRequired,tokenId:t.oneOfType([t.string,t.number]).isRequired};const B=({permissions:n,headers:d,contentType:T,isLoading:D,tokens:M,onConfirmDelete:_,tokenType:l})=>{const{canDelete:m,canUpdate:f,canRead:y}=n;return(0,s.jsx)(i.Ee,{headers:d,contentType:T,rows:M,withBulkActions:m||f||y,isLoading:D,onConfirmDelete:_,children:(0,s.jsx)(W,{tokenType:l,permissions:n,onConfirmDelete:_})})};B.propTypes={tokens:t.array,permissions:t.shape({canRead:t.bool,canDelete:t.bool,canUpdate:t.bool}).isRequired,headers:t.arrayOf(t.shape({cellFormatter:t.func,key:t.string.isRequired,metadatas:t.shape({label:t.string.isRequired,sortable:t.bool}).isRequired,name:t.string.isRequired})),contentType:t.string.isRequired,isLoading:t.bool,onConfirmDelete:t.func,tokenType:t.string.isRequired},B.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const W=({tokenType:n,permissions:d,rows:T,withBulkActions:D,onConfirmDelete:M})=>{const{canDelete:_,canUpdate:l,canRead:m}=d,[{query:f}]=(0,i.sq)(),{formatMessage:y}=(0,R.A)(),[,c]=f?f.sort.split(":"):"ASC",{push:u,location:{pathname:$}}=(0,h.W6)(),{trackUsage:L}=(0,i.z1)(),z=T.sort((o,E)=>{const v=o.name.localeCompare(E.name);return c==="DESC"?-v:v});return(0,s.jsx)(p.N,{children:z.map(o=>(0,s.jsxs)(K.Tr,{...(0,i.qM)({fn(){L("willEditTokenFromList",{tokenType:n}),u(`${$}/${o.id}`)},condition:l}),children:[(0,s.jsx)(g.Td,{maxWidth:(0,i.a8)(250),children:(0,s.jsx)(P.o,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0,children:o.name})}),(0,s.jsx)(g.Td,{maxWidth:(0,i.a8)(250),children:(0,s.jsx)(P.o,{textColor:"neutral800",ellipsis:!0,children:o.description})}),(0,s.jsx)(g.Td,{children:(0,s.jsx)(P.o,{textColor:"neutral800",children:(0,s.jsx)(i.sR,{timestamp:new Date(o.createdAt)})})}),(0,s.jsx)(g.Td,{children:o.lastUsedAt&&(0,s.jsx)(P.o,{textColor:"neutral800",children:(0,s.jsx)(i.sR,{timestamp:new Date(o.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:y({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]})})}),D&&(0,s.jsx)(g.Td,{children:(0,s.jsxs)(I.s,{justifyContent:"end",children:[l&&(0,s.jsx)(V,{tokenName:o.name,tokenId:o.id}),!l&&m&&(0,s.jsx)(N,{tokenName:o.name,tokenId:o.id}),_&&(0,s.jsx)(S,{tokenName:o.name,onClickDelete:()=>M(o.id),tokenType:n})]})})]},o.id))})};W.defaultProps={rows:[],withBulkActions:!1},W.propTypes={rows:t.array,permissions:t.shape({canRead:t.bool,canDelete:t.bool,canUpdate:t.bool}).isRequired,onConfirmDelete:t.func.isRequired,tokenType:t.string.isRequired,withBulkActions:t.bool}}}]);
