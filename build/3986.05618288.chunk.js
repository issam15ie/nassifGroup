"use strict";(self.webpackChunknassif_group_strapi=self.webpackChunknassif_group_strapi||[]).push([[3986],{58593:(Y,O,t)=>{t.d(O,{A:()=>e,T:()=>n});const e="api-token",n="transfer-token"},73986:(Y,O,t)=>{t.r(O),t.d(O,{default:()=>f});var e=t(92132),n=t(56445),I=t(82437),U=t(97927),R=t(21272),j=t(4198),P=t(55356),A=t(38413),i=t(5194),s=t(5409),C=t(54894),g=t(74930),k=t(17703),u=t(58593),S=t(84977),H=t(55151),b=t(79077),N=t(59057),G=t(15126),J=t(63299),h=t(67014),$=t(59080),z=t(79275),v=t(14718),B=t(61535),a=t(5790),r=t(12083),c=t(41286),D=t(35223),M=t(2600),_=t(48940),l=t(51187);const m=[{name:"name",key:"name",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.name",defaultMessage:"Name"},sortable:!0}},{name:"description",key:"description",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.description",defaultMessage:"Description"},sortable:!1}},{name:"createdAt",key:"createdAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.createdAt",defaultMessage:"Created at"},sortable:!1}},{name:"lastUsedAt",key:"lastUsedAt",metadatas:{label:{id:"Settings.apiTokens.ListView.headers.lastUsedAt",defaultMessage:"Last used"},sortable:!1}}],T=()=>{(0,n.L4)();const L=(0,g.useQueryClient)(),{formatMessage:p}=(0,C.A)(),W=(0,n.hN)(),F=(0,I.d4)(U.s),{allowedActions:{canCreate:y,canDelete:o,canUpdate:V,canRead:E}}=(0,n.ec)(F.settings["api-tokens"]),{push:X}=(0,k.W6)(),{trackUsage:x}=(0,n.z1)(),{startSection:tt}=(0,n.Cx)(),Z=R.useRef(tt),{get:et,del:st}=(0,n.ry)(),{formatAPIError:w}=(0,n.wq)();R.useEffect(()=>{Z.current&&Z.current("apiTokens")},[]),R.useEffect(()=>{X({search:s.stringify({sort:"name:ASC"},{encode:!1})})},[X]);const nt=m.map(d=>({...d,metadatas:{...d.metadatas,label:p(d.metadatas.label)}})),{data:K,isLoading:at}=(0,g.useQuery)(["api-tokens"],async()=>{x("willAccessTokenList",{tokenType:u.A});const{data:{data:d}}=await et("/admin/api-tokens");return x("didAccessTokenList",{number:d.length,tokenType:u.A}),d},{cacheTime:0,enabled:E,onError(d){W({type:"warning",message:w(d)})}}),q=at,ot=(0,g.useMutation)(async d=>{await st(`/admin/api-tokens/${d}`)},{async onSuccess(){await L.invalidateQueries(["api-tokens"]),x("didDeleteToken")},onError(d){W({type:"warning",message:w(d)})}}),Q=K&&K.length>0,it=E&&Q,dt=E&&!Q&&!y,rt=E&&!Q&&y;return(0,e.jsxs)(A.g,{"aria-busy":q,children:[(0,e.jsx)(n.x7,{name:"API Tokens"}),(0,e.jsx)(P.Q,{title:p({id:"Settings.apiTokens.title",defaultMessage:"API Tokens"}),subtitle:p({id:"Settings.apiTokens.description",defaultMessage:"List of generated tokens to consume the API"}),primaryAction:y&&(0,e.jsx)(n.z9,{"data-testid":"create-api-token-button",startIcon:(0,e.jsx)(i.A,{}),size:"S",onClick:()=>x("willAddTokenFromList",{tokenType:u.A}),to:"/settings/api-tokens/create",children:p({id:"Settings.apiTokens.create",defaultMessage:"Create new API Token"})})}),(0,e.jsxs)(j.s,{children:[!E&&(0,e.jsx)(n.UW,{}),it&&(0,e.jsx)(S.T,{permissions:{canRead:E,canDelete:o,canUpdate:V},headers:nt,contentType:"api-tokens",rows:K,isLoading:q,onConfirmDelete:d=>ot.mutateAsync(d),tokens:K,tokenType:u.A}),rt&&(0,e.jsx)(n.R1,{content:{id:"Settings.apiTokens.addFirstToken",defaultMessage:"Add your first API Token"},action:(0,e.jsx)(n.z9,{variant:"secondary",startIcon:(0,e.jsx)(i.A,{}),to:"/settings/api-tokens/create",children:p({id:"Settings.apiTokens.addNewToken",defaultMessage:"Add new API Token"})})}),dt&&(0,e.jsx)(n.R1,{content:{id:"Settings.apiTokens.emptyStateLayout",defaultMessage:"You don\u2019t have any content yet..."}})]})]})},f=()=>{const L=(0,I.d4)(U.s);return(0,e.jsx)(n.kz,{permissions:L.settings["api-tokens"].main,children:(0,e.jsx)(T,{})})}},84977:(Y,O,t)=>{t.d(O,{T:()=>v});var e=t(92132),n=t(94061),I=t(88353),U=t(83997),R=t(25641),j=t(90361),P=t(33363),A=t(30893),i=t(56445),s=t(33544),C=t(54894),g=t(17703),k=t(21272),u=t(83925),S=t(41909),H=t(50612),b=t(94929);const N=({tokenName:a,onClickDelete:r,tokenType:c})=>{const{formatMessage:D}=(0,C.A)(),{trackUsage:M}=(0,i.z1)(),[_,l]=(0,k.useState)(!1),m=()=>{l(!1),M("willDeleteToken",{tokenType:c}),r()};return(0,e.jsxs)(n.a,{paddingLeft:1,onClick:T=>T.stopPropagation(),children:[(0,e.jsx)(I.K,{onClick:()=>{l(!0)},label:D({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${a}`}),name:"delete",noBorder:!0,icon:(0,e.jsx)(H.A,{})}),(0,e.jsx)(i.TM,{onToggleDialog:()=>l(!1),onConfirm:m,isOpen:_})]})};N.propTypes={tokenName:s.string.isRequired,onClickDelete:s.func.isRequired,tokenType:s.string.isRequired};const G={edit:{id:"app.component.table.edit",defaultMessage:"Edit {target}"},read:{id:"app.component.table.read",defaultMessage:"Read {target}"}},J=(0,b.Ay)(i.N_)`
  svg {
    path {
      fill: ${({theme:a})=>a.colors.neutral500};
    }
  }

  &:hover,
  &:focus {
    svg {
      path {
        fill: ${({theme:a})=>a.colors.neutral800};
      }
    }
  }
`,h=({tokenName:a,tokenId:r,buttonType:c,children:D})=>{const{formatMessage:M}=(0,C.A)(),{location:{pathname:_}}=(0,g.W6)();return(0,e.jsx)(J,{to:`${_}/${r}`,title:M(G[c],{target:a}),children:D})};h.propTypes={tokenName:s.string.isRequired,tokenId:s.oneOfType([s.string,s.number]).isRequired,buttonType:s.string,children:s.node.isRequired},h.defaultProps={buttonType:"edit"};const $=({tokenName:a,tokenId:r})=>(0,e.jsx)(h,{tokenName:a,tokenId:r,buttonType:"read",children:(0,e.jsx)(u.A,{})});$.propTypes={tokenName:s.string.isRequired,tokenId:s.oneOfType([s.string,s.number]).isRequired};const z=({tokenName:a,tokenId:r})=>(0,e.jsx)(h,{tokenName:a,tokenId:r,children:(0,e.jsx)(S.A,{})});z.propTypes={tokenName:s.string.isRequired,tokenId:s.oneOfType([s.string,s.number]).isRequired};const v=({permissions:a,headers:r,contentType:c,isLoading:D,tokens:M,onConfirmDelete:_,tokenType:l})=>{const{canDelete:m,canUpdate:T,canRead:f}=a;return(0,e.jsx)(i.Ee,{headers:r,contentType:c,rows:M,withBulkActions:m||T||f,isLoading:D,onConfirmDelete:_,children:(0,e.jsx)(B,{tokenType:l,permissions:a,onConfirmDelete:_})})};v.propTypes={tokens:s.array,permissions:s.shape({canRead:s.bool,canDelete:s.bool,canUpdate:s.bool}).isRequired,headers:s.arrayOf(s.shape({cellFormatter:s.func,key:s.string.isRequired,metadatas:s.shape({label:s.string.isRequired,sortable:s.bool}).isRequired,name:s.string.isRequired})),contentType:s.string.isRequired,isLoading:s.bool,onConfirmDelete:s.func,tokenType:s.string.isRequired},v.defaultProps={tokens:[],headers:[],isLoading:!1,onConfirmDelete(){}};const B=({tokenType:a,permissions:r,rows:c,withBulkActions:D,onConfirmDelete:M})=>{const{canDelete:_,canUpdate:l,canRead:m}=r,[{query:T}]=(0,i.sq)(),{formatMessage:f}=(0,C.A)(),[,L]=T?T.sort.split(":"):"ASC",{push:p,location:{pathname:W}}=(0,g.W6)(),{trackUsage:F}=(0,i.z1)(),y=c.sort((o,V)=>{const E=o.name.localeCompare(V.name);return L==="DESC"?-E:E});return(0,e.jsx)(R.N,{children:y.map(o=>(0,e.jsxs)(j.Tr,{...(0,i.qM)({fn(){F("willEditTokenFromList",{tokenType:a}),p(`${W}/${o.id}`)},condition:l}),children:[(0,e.jsx)(P.Td,{maxWidth:(0,i.a8)(250),children:(0,e.jsx)(A.o,{textColor:"neutral800",fontWeight:"bold",ellipsis:!0,children:o.name})}),(0,e.jsx)(P.Td,{maxWidth:(0,i.a8)(250),children:(0,e.jsx)(A.o,{textColor:"neutral800",ellipsis:!0,children:o.description})}),(0,e.jsx)(P.Td,{children:(0,e.jsx)(A.o,{textColor:"neutral800",children:(0,e.jsx)(i.sR,{timestamp:new Date(o.createdAt)})})}),(0,e.jsx)(P.Td,{children:o.lastUsedAt&&(0,e.jsx)(A.o,{textColor:"neutral800",children:(0,e.jsx)(i.sR,{timestamp:new Date(o.lastUsedAt),customIntervals:[{unit:"hours",threshold:1,text:f({id:"Settings.apiTokens.lastHour",defaultMessage:"last hour"})}]})})}),D&&(0,e.jsx)(P.Td,{children:(0,e.jsxs)(U.s,{justifyContent:"end",children:[l&&(0,e.jsx)(z,{tokenName:o.name,tokenId:o.id}),!l&&m&&(0,e.jsx)($,{tokenName:o.name,tokenId:o.id}),_&&(0,e.jsx)(N,{tokenName:o.name,onClickDelete:()=>M(o.id),tokenType:a})]})})]},o.id))})};B.defaultProps={rows:[],withBulkActions:!1},B.propTypes={rows:s.array,permissions:s.shape({canRead:s.bool,canDelete:s.bool,canUpdate:s.bool}).isRequired,onConfirmDelete:s.func.isRequired,tokenType:s.string.isRequired,withBulkActions:s.bool}}}]);
