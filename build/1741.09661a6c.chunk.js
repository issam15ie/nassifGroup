"use strict";(self.webpackChunknassif_group_strapi=self.webpackChunknassif_group_strapi||[]).push([[1741],{1741:(te,R,s)=>{s.r(R),s.d(R,{ProvidersPage:()=>J,default:()=>Oe});var e=s(92132),p=s(21272),b=s(85963),C=s(90151),U=s(68074),A=s(88353),M=s(42455),W=s(4198),ae=s(55356),re=s(38413),ne=s(61485),de=s(99248),le=s(67030),oe=s(6239),ue=s(83997),_e=s(35513),ce=s(25641),ge=s(26127),k=s(90361),v=s(33363),me=s(7537),pe=s(7441),j=s(30893),Ee=s(98765),r=s(56445),Pe=s(41909),he=s(39404),B=s(54894),I=s(74930),Me=s(37679),ve=s(60043),fe=s(61535),i=s(33544),n=s(27985),Te=s(77965),t=s(12083);const K=({description:l,disabled:f,intlLabel:E,error:c,name:_,onChange:O,placeholder:d,providerToEditName:P,type:m,value:u})=>{const{formatMessage:o}=(0,B.A)(),h=_==="noName"?`${window.strapi.backendURL}/api/connect/${P}/callback`:u,D=o({id:E.id,defaultMessage:E.defaultMessage},{provider:P,...E.values}),g=l?o({id:l.id,defaultMessage:l.defaultMessage},{provider:P,...l.values}):"";if(m==="bool")return(0,e.jsx)(pe.l,{"aria-label":_,checked:u,disabled:f,hint:g,label:D,name:_,offLabel:o({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:o({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:L=>{O({target:{name:_,value:L.target.checked}})}});const N=d?o({id:d.id,defaultMessage:d.defaultMessage},{...d.values}):"",q=c?o({id:c,defaultMessage:c}):"";return(0,e.jsx)(me.k,{"aria-label":_,disabled:f,error:q,label:D,name:_,onChange:O,placeholder:N,type:m,value:h})};K.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""},K.propTypes={description:i.shape({id:i.string.isRequired,defaultMessage:i.string.isRequired,values:i.object}),disabled:i.bool,error:i.string,intlLabel:i.shape({id:i.string.isRequired,defaultMessage:i.string.isRequired,values:i.object}).isRequired,name:i.string.isRequired,onChange:i.func.isRequired,placeholder:i.shape({id:i.string.isRequired,defaultMessage:i.string.isRequired,values:i.object}),providerToEditName:i.string.isRequired,type:i.string.isRequired,value:i.oneOfType([i.bool,i.string])};const Y=({headerBreadcrumbs:l,initialData:f,isSubmiting:E,layout:c,isOpen:_,onSubmit:O,onToggle:d,providerToEditName:P})=>{const{formatMessage:m}=(0,B.A)();return _?(0,e.jsxs)(ne.k,{onClose:d,labelledBy:"title",children:[(0,e.jsx)(de.r,{children:(0,e.jsx)(Me.B,{label:l.join(", "),children:l.map((u,o,h)=>(0,e.jsx)(ve.m,{isCurrent:o===h.length-1,children:u},u))})}),(0,e.jsx)(fe.l1,{onSubmit:u=>O(u),initialValues:f,validationSchema:c.schema,validateOnChange:!1,children:({errors:u,handleChange:o,values:h})=>(0,e.jsxs)(r.lV,{children:[(0,e.jsx)(oe.c,{children:(0,e.jsx)(ue.s,{direction:"column",alignItems:"stretch",gap:1,children:(0,e.jsx)(C.x,{gap:5,children:c.form.map(D=>D.map(g=>(0,e.jsx)(U.E,{col:g.size,xs:12,children:(0,e.jsx)(K,{...g,error:u[g.name],onChange:o,value:h[g.name],providerToEditName:P})},g.name)))})})}),(0,e.jsx)(le.j,{startActions:(0,e.jsx)(b.$,{variant:"tertiary",onClick:d,type:"button",children:m({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(b.$,{type:"submit",loading:E,children:m({id:"global.save",defaultMessage:"Save"})})})]})})]}):null};Y.defaultProps={initialData:null,providerToEditName:null},Y.propTypes={headerBreadcrumbs:i.arrayOf(i.string).isRequired,initialData:i.object,layout:i.shape({form:i.arrayOf(i.array),schema:i.object}).isRequired,isOpen:i.bool.isRequired,isSubmiting:i.bool.isRequired,onSubmit:i.func.isRequired,onToggle:i.func.isRequired,providerToEditName:i.string};const H={id:(0,n.g)("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},V={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},S={id:(0,n.g)("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},z={id:(0,n.g)("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},G={id:(0,n.g)("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},X={id:(0,n.g)("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},y={id:(0,n.g)("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},w={id:(0,n.g)("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"},F={email:{form:[[{intlLabel:z,name:"enabled",type:"bool",description:S,size:6}]],schema:t.Ik().shape({enabled:t.lc().required(r.iW.required)})},providers:{form:[[{intlLabel:z,name:"enabled",type:"bool",description:S,size:6,validations:{required:!0}}],[{intlLabel:G,name:"key",type:"text",placeholder:y,size:12,validations:{required:!0}}],[{intlLabel:w,name:"secret",type:"text",placeholder:y,size:12,validations:{required:!0}}],[{intlLabel:H,placeholder:V,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:X,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:t.Ik().shape({enabled:t.lc().required(r.iW.required),key:t.Yj().when("enabled",{is:!0,then:t.Yj().required(r.iW.required),otherwise:t.Yj()}),secret:t.Yj().when("enabled",{is:!0,then:t.Yj().required(r.iW.required),otherwise:t.Yj()}),callback:t.Yj().when("enabled",{is:!0,then:t.Yj().required(r.iW.required),otherwise:t.Yj()})})},providersWithSubdomain:{form:[[{intlLabel:z,name:"enabled",type:"bool",description:S,size:6,validations:{required:!0}}],[{intlLabel:G,name:"key",type:"text",placeholder:y,size:12,validations:{required:!0}}],[{intlLabel:w,name:"secret",type:"text",placeholder:y,size:12,validations:{required:!0}}],[{intlLabel:{id:(0,n.g)({id:"PopUpForm.Providers.jwksurl.label"}),defaultMessage:"JWKS URL"},name:"jwksurl",type:"text",placeholder:y,size:12,validations:{required:!1}}],[{intlLabel:{id:(0,n.g)("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:(0,n.g)("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:H,placeholder:V,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:X,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:t.Ik().shape({enabled:t.lc().required(r.iW.required),key:t.Yj().when("enabled",{is:!0,then:t.Yj().required(r.iW.required),otherwise:t.Yj()}),secret:t.Yj().when("enabled",{is:!0,then:t.Yj().required(r.iW.required),otherwise:t.Yj()}),subdomain:t.Yj().when("enabled",{is:!0,then:t.Yj().required(r.iW.required),otherwise:t.Yj()}),callback:t.Yj().when("enabled",{is:!0,then:t.Yj().required(r.iW.required),otherwise:t.Yj()})})}},J=()=>{const{formatMessage:l,locale:f}=(0,B.A)(),E=(0,I.useQueryClient)(),{trackUsage:c}=(0,r.z1)(),[_,O]=p.useState(!1),[d,P]=p.useState(null),m=(0,r.hN)(),{lockApp:u,unlockApp:o}=(0,r.MA)(),{get:h,put:D}=(0,r.ry)(),{formatAPIError:g}=(0,r.wq)(),N=(0,r.QM)(f,{sensitivity:"base"});(0,r.L4)();const{isLoading:q,allowedActions:{canUpdate:L}}=(0,r.ec)({update:n.P.updateProviders}),{isLoading:De,data:$}=(0,I.useQuery)(["users-permissions","get-providers"],async()=>{const{data:a}=await h("/users-permissions/providers");return a},{initialData:{}}),Z=(0,I.useMutation)(a=>D("/users-permissions/providers",a),{async onSuccess(){await E.invalidateQueries(["users-permissions","providers"]),m({type:"success",message:{id:(0,n.g)("notification.success.submit")}}),c("didEditAuthenticationProvider"),Q(),o()},onError(a){m({type:"warning",message:g(a)}),o()},refetchActive:!1}),T=Object.entries($).reduce((a,[x,Le])=>{const{icon:ie,enabled:xe,subdomain:Re}=Le;return a.push({name:x,icon:ie==="envelope"?["fas","envelope"]:["fab",ie],enabled:xe,subdomain:Re}),a},[]).sort((a,x)=>N.compare(a.name,x.name)),be=De||q,ee=p.useMemo(()=>d?!!T.find(x=>x.name===d)?.subdomain:!1,[T,d]),je=p.useMemo(()=>d==="email"?F.email:ee?F.providersWithSubdomain:F.providers,[d,ee]),Q=()=>{O(a=>!a)},se=a=>{L&&(P(a.name),Q())},ye=async a=>{u(),c("willEditAuthenticationProvider"),Z.mutate({providers:{...$,[d]:a}})};return(0,e.jsxs)(M.P,{children:[(0,e.jsx)(r.x7,{name:l({id:(0,n.g)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),(0,e.jsxs)(re.g,{children:[(0,e.jsx)(ae.Q,{title:l({id:(0,n.g)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),be?(0,e.jsx)(r.Bl,{}):(0,e.jsx)(W.s,{children:(0,e.jsxs)(_e.X,{colCount:3,rowCount:T.length+1,children:[(0,e.jsx)(ge.d,{children:(0,e.jsxs)(k.Tr,{children:[(0,e.jsx)(v.Th,{children:(0,e.jsx)(j.o,{variant:"sigma",textColor:"neutral600",children:l({id:"global.name",defaultMessage:"Name"})})}),(0,e.jsx)(v.Th,{children:(0,e.jsx)(j.o,{variant:"sigma",textColor:"neutral600",children:l({id:(0,n.g)("Providers.status"),defaultMessage:"Status"})})}),(0,e.jsx)(v.Th,{children:(0,e.jsx)(j.o,{variant:"sigma",children:(0,e.jsx)(Ee.s,{children:l({id:"global.settings",defaultMessage:"Settings"})})})})]})}),(0,e.jsx)(ce.N,{children:T.map(a=>(0,e.jsxs)(k.Tr,{...(0,r.qM)({fn:()=>se(a),condition:L}),children:[(0,e.jsx)(v.Td,{width:"45%",children:(0,e.jsx)(j.o,{fontWeight:"semiBold",textColor:"neutral800",children:a.name})}),(0,e.jsx)(v.Td,{width:"65%",children:(0,e.jsx)(j.o,{textColor:a.enabled?"success600":"danger600","data-testid":`enable-${a.name}`,children:a.enabled?l({id:"global.enabled",defaultMessage:"Enabled"}):l({id:"global.disabled",defaultMessage:"Disabled"})})}),(0,e.jsx)(v.Td,{...r.dG,children:L&&(0,e.jsx)(A.K,{onClick:()=>se(a),noBorder:!0,icon:(0,e.jsx)(Pe.A,{}),label:"Edit"})})]},a.name))})]})})]}),(0,e.jsx)(Y,{initialData:$[d],isOpen:_,isSubmiting:Z.isLoading,layout:je,headerBreadcrumbs:[l({id:(0,n.g)("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),he(d)],onToggle:Q,onSubmit:ye,providerToEditName:d})]})},Oe=()=>(0,e.jsx)(r.kz,{permissions:n.P.readProviders,children:(0,e.jsx)(J,{})})},42455:(te,R,s)=>{s.d(R,{P:()=>A});var e=s(92132),p=s(94929),b=s(94061);const C=(0,p.Ay)(b.a)`
  display: grid;
  grid-template-columns: ${({hasSideNav:M})=>M?"auto 1fr":"1fr"};
`,U=(0,p.Ay)(b.a)`
  overflow-x: hidden;
`,A=({sideNav:M,children:W})=>(0,e.jsxs)(C,{hasSideNav:Boolean(M),children:[M,(0,e.jsx)(U,{paddingBottom:10,children:W})]})}}]);
