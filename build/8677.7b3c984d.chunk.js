"use strict";(self.webpackChunknassif_group_strapi=self.webpackChunknassif_group_strapi||[]).push([[8677],{8815:(J,p,s)=>{s.d(p,{T:()=>X});var e=s(92132),M=s(21272),R=s(94061),h=s(85963),I=s(90151),T=s(68074),K=s(4198),S=s(55356),W=s(38413),U=s(83997),N=s(30893),a=s(56445),V=s(61535),u=s(54894),F=s(74930),Y=s(82437),B=s(17703),z=s(97927),$=s(89565),m=s(58593),c=s(28746),n=s(33544),Q=s(54514),f=s(12083);const A=({errors:_,onChange:d,canEditInputs:g,isCreating:o,values:E,transferToken:r})=>{const{formatMessage:P}=(0,u.A)(),j=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return(0,e.jsx)(R.a,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(U.s,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(N.o,{variant:"delta",as:"h2",children:P({id:"global.details",defaultMessage:"Details"})}),(0,e.jsxs)(I.x,{gap:5,children:[(0,e.jsx)(T.E,{col:6,xs:12,children:(0,e.jsx)(c.T,{errors:_,values:E,canEditInputs:g,onChange:d})},"name"),(0,e.jsx)(T.E,{col:6,xs:12,children:(0,e.jsx)(c.a,{errors:_,values:E,canEditInputs:g,onChange:d})},"description"),(0,e.jsx)(T.E,{col:6,xs:12,children:(0,e.jsx)(c.L,{isCreating:o,errors:_,values:E,onChange:d,token:r})},"lifespan"),(0,e.jsx)(T.E,{col:6,xs:12,children:(0,e.jsx)(c.b,{name:"permissions",values:E,errors:_,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:O=>{d({target:{name:"permissions",value:O}})},options:j,canEditInputs:g})},"permissions")]})]})})};A.propTypes={errors:n.shape({name:n.string,description:n.string,lifespan:n.string,type:n.string}),onChange:n.func.isRequired,canEditInputs:n.bool.isRequired,values:n.shape({name:n.string,description:n.string,lifespan:n.oneOfType([n.number,n.string]),type:n.string}).isRequired,isCreating:n.bool.isRequired,transferToken:n.shape({id:n.oneOfType([n.number,n.string]),type:n.string,lifespan:n.string,name:n.string,accessKey:n.string,permissions:n.array,description:n.string,createdAt:n.string})},A.defaultProps={errors:{},transferToken:{}};const v=({transferTokenName:_})=>{const{formatMessage:d}=(0,u.A)();return(0,a.L4)(),(0,e.jsxs)(W.g,{"aria-busy":"true",children:[(0,e.jsx)(a.x7,{name:"Transfer Tokens"}),(0,e.jsx)(S.Q,{primaryAction:(0,e.jsx)(h.$,{disabled:!0,startIcon:(0,e.jsx)(Q.A,{}),type:"button",size:"L",children:d({id:"global.save",defaultMessage:"Save"})}),title:_||d({id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"})}),(0,e.jsx)(K.s,{children:(0,e.jsx)(a.Bl,{})})]})};v.defaultProps={transferTokenName:null},v.propTypes={transferTokenName:n.string};const y=f.Ik().shape({name:f.Yj(a.iW.string).max(100).required(a.iW.required),description:f.Yj().nullable(),lifespan:f.ai().integer().min(0).nullable().defined(a.iW.required),permissions:f.Yj(a.iW.string).required(a.iW.required)}),x="Name already taken",X=()=>{(0,a.L4)();const{formatMessage:_}=(0,u.A)(),{lockApp:d,unlockApp:g}=(0,a.MA)(),o=(0,a.hN)(),E=(0,B.W6)(),[r,P]=(0,M.useState)(E.location.state?.transferToken.accessKey?{...E.location.state.transferToken}:null),{trackUsage:j}=(0,a.z1)(),O=(0,M.useRef)(j),{setCurrentStep:Z}=(0,a.Cx)(),w=(0,Y.d4)(z.s),{allowedActions:{canCreate:b,canUpdate:q,canRegenerate:ss}}=(0,a.ec)(w.settings["transfer-tokens"]),{params:{id:C}}=(0,B.W5)("/settings/transfer-tokens/:id"),{get:es,post:ns,put:ts}=(0,a.ry)(),i=C==="create",{formatAPIError:G}=(0,a.wq)();(0,M.useEffect)(()=>{O.current(i?"didAddTokenFromList":"didEditTokenFromList",{tokenType:m.T})},[i]);const{status:as}=(0,F.useQuery)(["transfer-token",C],async()=>{const{data:{data:t}}=await es(`/admin/transfer/tokens/${C}`);return P({...t}),t},{enabled:!i&&!r,onError(t){t.response.data.error.details?.code==="INVALID_TOKEN_SALT"?o({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):o({type:"warning",message:G(t)})}}),rs=async(t,D)=>{O.current(i?"willCreateToken":"willEditToken",{tokenType:m.T}),d();const k=t.lifespan&&parseInt(t.lifespan,10)&&t.lifespan!=="0"?parseInt(t.lifespan,10):null,L=t.permissions.split("-");try{const{data:{data:l}}=i?await ns("/admin/transfer/tokens",{...t,lifespan:k,permissions:L}):await ts(`/admin/transfer/tokens/${C}`,{name:t.name,description:t.description,permissions:L});g(),i&&(E.replace(`/settings/transfer-tokens/${l.id}`,{transferToken:l}),Z("transferTokens.success")),P({...l}),o({type:"success",message:_(i?{id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"}:{id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),O.current(i?"didCreateToken":"didEditToken",{type:r?.permissions,tokenType:m.T})}catch(l){const os=(0,$.f)(l.response.data);D.setErrors(os),l?.response?.data?.error?.message===x?o({type:"warning",message:l.response.data.message||"notification.error.tokennamenotunique"}):l?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?o({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):o({type:"warning",message:l?.response?.data?.message||"notification.error"}),g()}},H=q&&!i||b&&i;if(!i&&!r&&as!=="success")return(0,e.jsx)(v,{transferTokenName:r?.name});const is=t=>{t?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?o({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):o({type:"warning",message:G(t)})};return(0,e.jsxs)(W.g,{children:[(0,e.jsx)(a.x7,{name:"Transfer Tokens"}),(0,e.jsx)(V.l1,{validationSchema:y,validateOnChange:!1,initialValues:{name:r?.name||"",description:r?.description||"",lifespan:r?.lifespan?r.lifespan.toString():r?.lifespan,permissions:r?.permissions.join("-")},enableReinitialize:!0,onSubmit:(t,D)=>rs(t,D),children:({errors:t,handleChange:D,isSubmitting:k,values:L})=>(0,e.jsxs)(a.lV,{children:[(0,e.jsx)(c.F,{backUrl:"/settings/transfer-tokens",title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"},token:r,setToken:P,canEditInputs:H,canRegenerate:ss,isSubmitting:k,regenerateUrl:"/admin/transfer/tokens/",onErrorRegenerate:is}),(0,e.jsx)(K.s,{children:(0,e.jsxs)(U.s,{direction:"column",alignItems:"stretch",gap:6,children:[Boolean(r?.name)&&(0,e.jsx)(c.c,{token:r?.accessKey,tokenType:m.T}),(0,e.jsx)(A,{errors:t,onChange:D,canEditInputs:H,isCreating:i,values:L,transferToken:r})]})})]})})]})}},88677:(J,p,s)=>{s.r(p),s.d(p,{default:()=>y});var e=s(92132),M=s(56445),R=s(82437),h=s(97927),I=s(8815),T=s(21272),K=s(74930),S=s(55151),W=s(79077),U=s(59057),N=s(15126),a=s(63299),V=s(67014),u=s(59080),F=s(79275),Y=s(14718),B=s(61535),z=s(5790),$=s(12083),m=s(41286),c=s(35223),n=s(5409),Q=s(2600),f=s(48940),A=s(51187),v=s(28746);const y=()=>{const x=(0,R.d4)(h.s);return(0,e.jsx)(M.kz,{permissions:x.settings["transfer-tokens"].read,children:(0,e.jsx)(I.T,{})})}}}]);
