"use strict";(self.webpackChunknassif_group_strapi=self.webpackChunknassif_group_strapi||[]).push([[6e3],{8589:(B,p,s)=>{s.d(p,{u:()=>D});var e=s(21272),a=s(56445),P=s(74930);function D(c={},T={}){const{id:g="",...f}=c,{get:y}=(0,a.ry)(),{data:u,isError:A,isLoading:R,refetch:C}=(0,P.useQuery)(["users",g,f],async()=>{const{data:{data:M}}=await y(`/admin/users/${g}`,{params:f});return M},T);return{users:e.useMemo(()=>{let M=[];return u&&("results"in u?Array.isArray(u.results)&&(M=u.results):M=[u]),M},[u]),pagination:e.useMemo(()=>(u&&"pagination"in u)??null,[u]),isLoading:R,isError:A,refetch:C}}},74773:(B,p,s)=>{s.d(p,{B:()=>P});var e=s(92132),a=s(83997);const P=({startActions:D,endActions:c})=>!D&&!c?null:(0,e.jsxs)(a.s,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(a.s,{gap:2,wrap:"wrap",children:D}),(0,e.jsx)(a.s,{gap:2,shrink:0,wrap:"wrap",children:c})]})},80782:(B,p,s)=>{s.d(p,{j:()=>a});var e=s(76517);const a=e.c$},86e3:(B,p,s)=>{s.r(p),s.d(p,{default:()=>ms});var e=s(92132),a=s(56445),P=s(82437),D=s(97927),c=s(94061),T=s(76517),g=s(80782),f=s(90151),y=s(88353),u=s(4171),A=s(42455),R=s(74773),C=s(4198),U=s(55356),M=s(43064),F=s(38413),Z=s(61485),X=s(99248),w=s(6239),j=s(83997),q=s(25641),k=s(90361),z=s(33363),x=s(30893),v=s(54894),ss=s(90532),Q=s(74930),es=s(17703),ts=s(8589),as=s(37679),ns=s(60043),i=s(33544),is=s(62490),os=s(83925),us=s(21272),Es=s(55151),gs=s(79077),cs=s(59057),ps=s(15126),Ms=s(63299),Ds=s(67014),Os=s(59080),Ps=s(79275),Ls=s(14718),fs=s(61535),ys=s(5790),As=s(12083),Cs=s(41286),hs=s(35223),Ts=s(5409),Rs=s(2600),Us=s(48940),vs=s(51187);const rs=({canReadAuditLogs:t,canReadUsers:l})=>{const{get:m}=(0,a.ry)(),{search:o}=(0,es.zy)(),_=(0,a.hN)(),[{query:d}]=(0,a.sq)(),n={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:O=>_({type:"warning",message:O.message})},{users:r,isError:E,isLoading:L}=(0,ts.u)({},{...n,enabled:l,staleTime:2*(1e3*60)}),{data:h,isLoading:W,isError:S}=(0,Q.useQuery)(["auditLogs",o],async()=>{const{data:O}=await m("/admin/audit-logs",{params:d});return O},{...n,enabled:t});return{auditLogs:h,users:r,isLoading:L||W,hasError:S||E}},G=()=>{const{formatDate:t}=(0,v.A)();return m=>{const o=(0,is.A)(m),_=t(o,{dateStyle:"long"}),d=t(o,{timeStyle:"medium",hourCycle:"h24"});return`${_}, ${d}`}},H={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},N=t=>H[t]||t,I=({actionLabel:t,actionName:l})=>(0,e.jsxs)(j.s,{direction:"column",alignItems:"baseline",gap:1,children:[(0,e.jsx)(x.o,{textColor:"neutral600",variant:"sigma",children:t}),(0,e.jsx)(x.o,{textColor:"neutral600",children:l})]});I.propTypes={actionLabel:i.string.isRequired,actionName:i.string.isRequired};const $=({status:t,data:l,formattedDate:m})=>{const{formatMessage:o}=(0,v.A)();if(t==="loading")return(0,e.jsx)(j.s,{padding:7,justifyContent:"center",alignItems:"center",children:(0,e.jsx)(M.a,{children:"Loading content..."})});const{action:_,user:d,payload:n}=l;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(c.a,{marginBottom:3,children:(0,e.jsx)(x.o,{variant:"delta",id:"title",children:o({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"})})}),(0,e.jsxs)(f.x,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0,children:[(0,e.jsx)(I,{actionLabel:o({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:o({id:`Settings.permissions.auditLogs.${_}`,defaultMessage:N(_)},{model:n?.model})}),(0,e.jsx)(I,{actionLabel:o({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:m}),(0,e.jsx)(I,{actionLabel:o({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:d?.displayName||"-"}),(0,e.jsx)(I,{actionLabel:o({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:d?.id.toString()||"-"})]}),(0,e.jsx)(u.j,{value:JSON.stringify(n,null,2),disabled:!0,label:o({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})})]})};$.defaultProps={data:{}},$.propTypes={status:i.oneOf(["idle","loading","error","success"]).isRequired,data:i.shape({action:i.string,date:i.string,payload:i.object,user:i.object}),formattedDate:i.string.isRequired};const Y=({handleClose:t,logId:l})=>{const{get:m}=(0,a.ry)(),o=(0,a.hN)(),_=async L=>{const{data:h}=await m(`/admin/audit-logs/${L}`);if(!h)throw new Error("Audit log not found");return h},{data:d,status:n}=(0,Q.useQuery)(["audit-log",l],()=>_(l),{onError(){o({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),t()}}),r=G(),E=d?r(d.date):"";return(0,e.jsxs)(Z.k,{onClose:t,labelledBy:"title",children:[(0,e.jsx)(X.r,{children:(0,e.jsx)(as.B,{label:E,id:"title",children:(0,e.jsx)(ns.m,{isCurrent:!0,children:E})})}),(0,e.jsx)(w.c,{children:(0,e.jsx)($,{status:n,data:d,formattedDate:E})})]})};Y.propTypes={handleClose:i.func.isRequired,logId:i.string.isRequired};const b=({pagination:t})=>(0,e.jsx)(c.a,{paddingTop:4,children:(0,e.jsxs)(j.s,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(a._u,{}),(0,e.jsx)(a.W7,{pagination:t})]})});b.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},b.propTypes={pagination:i.shape({page:i.number,pageCount:i.number,pageSize:i.number,total:i.number})};const V=({headers:t,rows:l,onOpenModal:m})=>{const{formatMessage:o}=(0,v.A)(),_=G(),d=({type:n,value:r,model:E})=>n==="date"?_(r):n==="action"?o({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:N(r)},{model:E}):r||"-";return(0,e.jsx)(q.N,{children:l.map(n=>(0,e.jsxs)(k.Tr,{...(0,a.qM)({fn:()=>m(n.id)}),children:[t.map(({key:r,name:E,cellFormatter:L})=>(0,e.jsx)(z.Td,{children:(0,e.jsx)(x.o,{textColor:"neutral800",children:d({type:r,value:L?L(n[E]):n[E],model:n.payload?.model})})},r)),(0,e.jsx)(z.Td,{...a.dG,children:(0,e.jsx)(j.s,{justifyContent:"end",children:(0,e.jsx)(y.K,{onClick:()=>m(n.id),"aria-label":o({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${n.action} action`}),noBorder:!0,icon:(0,e.jsx)(os.A,{})})})})]},n.id))})};V.defaultProps={rows:[]},V.propTypes={headers:i.array.isRequired,rows:i.array,onOpenModal:i.func.isRequired};const K=({value:t,options:l,onChange:m})=>{const{formatMessage:o}=(0,v.A)(),_=o({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return(0,e.jsx)(T.G3,{"aria-label":_,value:t,onChange:m,children:l.map(({label:d,customValue:n})=>(0,e.jsx)(g.j,{value:n,children:d},n))})};K.defaultProps={value:null},K.propTypes={value:i.string,options:i.arrayOf(i.shape({label:i.string.isRequired,customValue:i.string.isRequired}).isRequired).isRequired,onChange:i.func.isRequired};const J=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],ds=({formatMessage:t,users:l,canReadUsers:m})=>{const o=Object.keys(H).map(d=>({label:t({id:`Settings.permissions.auditLogs.${d}`,defaultMessage:N(d)},{model:void 0}),customValue:d})),_=[{name:"action",metadatas:{customOperators:J,label:t({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),customInput:K,options:o},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:t({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(m&&l){const d=r=>r.username?r.username:r.firstname&&r.lastname?t({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:r.firstname,lastname:r.lastname}):r.email,n=l.map(r=>({label:d(r),customValue:r.id.toString()}));return[..._,{name:"user",metadatas:{customOperators:J,label:t({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:n,customInput:K},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return _},ls=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:t=>t?t.displayName:""}],_s=()=>{const{formatMessage:t}=(0,v.A)(),l=(0,P.d4)(D.s),{allowedActions:{canRead:m,canReadUsers:o}}=(0,a.ec)({...l.settings.auditLogs,readUsers:l.settings.users.read}),[{query:_},d]=(0,a.sq)(),{auditLogs:n,users:r,isLoading:E,hasError:L}=rs({canReadAuditLogs:m,canReadUsers:o});(0,a.L4)();const h=ds({formatMessage:t,users:r,canReadUsers:o}),W=t({id:"global.auditLogs",defaultMessage:"Audit Logs"}),S=ls.map(O=>({...O,metadatas:{...O.metadatas,label:t(O.metadatas.label)}}));return L?(0,e.jsx)(A.P,{children:(0,e.jsx)(C.s,{children:(0,e.jsx)(c.a,{paddingTop:8,children:(0,e.jsx)(a.hH,{})})})}):(0,e.jsxs)(F.g,{"aria-busy":E,children:[(0,e.jsx)(a.x7,{name:W}),(0,e.jsx)(U.Q,{title:W,subtitle:t({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),(0,e.jsx)(R.B,{startActions:(0,e.jsx)(ss.F,{displayedFilters:h})}),(0,e.jsxs)(C.s,{canRead:m,children:[(0,e.jsx)(a.Ee,{contentType:"Audit logs",headers:S,rows:n?.results||[],withBulkActions:!0,isLoading:E,children:(0,e.jsx)(V,{headers:S,rows:n?.results||[],onOpenModal:O=>d({id:O})})}),(0,e.jsx)(b,{pagination:n?.pagination})]}),_?.id&&(0,e.jsx)(Y,{handleClose:()=>d({id:null},"remove"),logId:_.id})]})},ms=()=>{const t=(0,P.d4)(D.s);return(0,e.jsx)(a.kz,{permissions:t.settings.auditLogs.main,children:(0,e.jsx)(_s,{})})}},90532:(B,p,s)=>{s.d(p,{F:()=>y});var e=s(92132),a=s(21272),P=s(94061),D=s(85963),c=s(56445),T=s(28604),g=s(33544),f=s(54894);const y=({displayedFilters:u})=>{const[A,R]=(0,a.useState)(!1),{formatMessage:C}=(0,f.A)(),U=(0,a.useRef)(),M=()=>{R(F=>!F)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(P.a,{paddingTop:1,paddingBottom:1,children:[(0,e.jsx)(D.$,{variant:"tertiary",ref:U,startIcon:(0,e.jsx)(T.A,{}),onClick:M,size:"S",children:C({id:"app.utils.filters",defaultMessage:"Filters"})}),A&&(0,e.jsx)(c.LC,{displayedFilters:u,isVisible:A,onToggle:M,source:U})]}),(0,e.jsx)(c.cZ,{filtersSchema:u})]})};y.propTypes={displayedFilters:g.arrayOf(g.shape({name:g.string.isRequired,metadatas:g.shape({label:g.string}),fieldSchema:g.shape({type:g.string})})).isRequired}}}]);
