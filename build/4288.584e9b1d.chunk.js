"use strict";(self.webpackChunknassif_group_strapi=self.webpackChunknassif_group_strapi||[]).push([[4288],{8589:(J,M,s)=>{s.d(M,{u:()=>o});var e=s(21272),t=s(56445),d=s(74930);function o(c={},K={}){const{id:n="",...m}=c,{get:y}=(0,t.ry)(),{data:r,isError:C,isLoading:I,refetch:j}=(0,d.useQuery)(["users",n,m],async()=>{const{data:{data:p}}=await y(`/admin/users/${n}`,{params:m});return p},K);return{users:e.useMemo(()=>{let p=[];return r&&("results"in r?Array.isArray(r.results)&&(p=r.results):p=[r]),p},[r]),pagination:e.useMemo(()=>(r&&"pagination"in r)??null,[r]),isLoading:I,isError:C,refetch:j}}},34313:(J,M,s)=>{s.d(M,{A:()=>d});var e=s(92132);const t=o=>(0,e.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...o,children:[(0,e.jsx)("path",{fill:"#32324D",d:"M0 2.8A.8.8 0 0 1 .8 2h22.4a.8.8 0 0 1 .8.8v2.71a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V2.8Z"}),(0,e.jsx)("path",{fill:"#32324D",d:"M1.922 7.991C.197 6.675 0 6.252 0 5.289h23.953c.305 1.363-1.594 2.506-2.297 3.125-1.953 1.363-6.253 4.36-7.828 5.45-1.575 1.09-3.031.455-3.562 0-2.063-1.41-6.62-4.557-8.344-5.873ZM22.8 18H1.2c-.663 0-1.2.471-1.2 1.053v1.894C0 21.529.537 22 1.2 22h21.6c.663 0 1.2-.471 1.2-1.053v-1.894c0-.582-.537-1.053-1.2-1.053Z"}),(0,e.jsx)("path",{fill:"#32324D",d:"M0 9.555v10.972h24V9.554c-2.633 1.95-8.367 6.113-9.96 7.166-1.595 1.052-3.352.438-4.032 0L0 9.555Z"})]}),d=t},54288:(J,M,s)=>{s.r(M),s.d(M,{U:()=>he,i:()=>Re});var e=s(92132),t=s(56445),d=s(82437),o=s(97927),c=s(21272),K=s(50215),n=s(94061),m=s(85963),y=s(90151),r=s(68074),C=s(88353),I=s(74773),j=s(4198),T=s(55356),p=s(38413),X=s(61485),re=s(99248),oe=s(67030),w=s(6239),g=s(83997),h=s(25641),S=s(90361),b=s(33363),L=s(30893),k=s(5409),f=s(54894),N=s(74930),ae=s(17703),le=s(8589),F=s(59057),de=s(90532),P=s(34313),fe=s(41909),De=s(50612),l=s(33544),Oe=s(37679),Pe=s(60043),Ae=s(61535),Ee=s(72249),q=s(12083);const ue=({onClick:a})=>{const{formatMessage:_}=(0,f.A)();return(0,e.jsx)(m.$,{onClick:a,startIcon:(0,e.jsx)(P.A,{}),size:"S",children:_({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})})};ue.propTypes={onClick:l.func.isRequired};const ce=({canDelete:a,headers:_,entriesToDelete:A,onClickDelete:ee,onSelectRow:V,withMainAction:$,withBulkActions:B,rows:v})=>{const{push:D,location:{pathname:Q}}=(0,ae.W6)(),{formatMessage:O}=(0,f.A)();return(0,e.jsx)(h.N,{children:v.map(i=>{const z=A.findIndex(R=>R===i.id)!==-1;return(0,e.jsxs)(S.Tr,{...(0,t.qM)({fn:()=>D(`${Q}/${i.id}`),condition:B}),children:[$&&(0,e.jsx)(b.Td,{...t.dG,children:(0,e.jsx)(K.J,{"aria-label":O({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,o.g)(i.firstname,i.lastname)}),checked:z,onChange:()=>{V({name:i.id,value:!z})}})}),_.map(({key:R,cellFormatter:Y,name:W,...Z})=>(0,e.jsx)(b.Td,{children:typeof Y=="function"?Y(i,{key:R,name:W,formatMessage:O,...Z}):(0,e.jsx)(L.o,{textColor:"neutral800",children:i[W]||"-"})},R)),B&&(0,e.jsx)(b.Td,{children:(0,e.jsxs)(g.s,{justifyContent:"end",children:[(0,e.jsx)(C.K,{onClick:()=>D(`${Q}/${i.id}`),label:O({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,o.g)(i.firstname,i.lastname)}),noBorder:!0,icon:(0,e.jsx)(fe.A,{})}),a&&(0,e.jsx)(n.a,{paddingLeft:1,...t.dG,children:(0,e.jsx)(C.K,{onClick:()=>ee(i.id),label:O({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,o.g)(i.firstname,i.lastname)}),noBorder:!0,icon:(0,e.jsx)(De.A,{})})})]})})]},i.id)})})};ce.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},ce.propTypes={canDelete:l.bool,entriesToDelete:l.array,headers:l.array.isRequired,onClickDelete:l.func,onSelectRow:l.func,rows:l.array,withBulkActions:l.bool,withMainAction:l.bool};const ge={firstname:"",lastname:"",email:"",roles:[]},xe=[],ye=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],Ce=q.Ik().shape({firstname:q.Yj().trim().required(t.iW.required),lastname:q.Yj(),email:q.Yj().email(t.iW.email).required(t.iW.required),roles:q.YO().min(1,t.iW.required).required(t.iW.required)}),je={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},Me=({onSuccess:a,onToggle:_})=>{const[A,ee]=(0,c.useState)("create"),[V,$]=(0,c.useState)(!1),[B,v]=(0,c.useState)(null),{formatMessage:D}=(0,f.A)(),Q=(0,t.hN)(),{lockApp:O,unlockApp:i}=(0,t.MA)(),{post:z}=(0,t.ry)(),R=(0,F.p)(xe,async()=>(await s.e(9656).then(s.bind(s,9656))).ROLE_LAYOUT,{combine(u,U){return[...u,U]},defaultValue:[]}),Y=(0,F.p)(ge,async()=>(await s.e(9656).then(s.bind(s,9656))).FORM_INITIAL_VALUES,{combine(u,U){return{...u,...U}},defaultValue:ge}),W=(0,F.p)(Ee.M,async()=>(await s.e(5227).then(s.bind(s,95227))).MagicLinkEE),Z=(0,N.useMutation)(u=>z("/admin/users",u),{async onSuccess({data:u}){v(u.data.registrationToken),await a(),ie(),$(!1)},onError(u){throw $(!1),Q({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),u},onSettled(){i()}}),se=D({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),ne=async(u,{setErrors:U})=>{O(),$(!0);try{await Z.mutateAsync(u)}catch(G){i(),G?.response?.data?.error.message==="Email already taken"&&U({email:G.response.data.error.message})}},ie=()=>{E?ee(E):_()},{buttonSubmitLabel:te,isDisabled:H,next:E}=je[A],Ue=A==="create"?(0,e.jsx)(m.$,{type:"submit",loading:V,children:D(te)}):(0,e.jsx)(m.$,{type:"button",loading:V,onClick:_,children:D(te)});return W?(0,e.jsxs)(X.k,{onClose:_,labelledBy:"title",children:[(0,e.jsx)(re.r,{children:(0,e.jsx)(Oe.B,{label:se,children:(0,e.jsx)(Pe.m,{isCurrent:!0,children:se})})}),(0,e.jsx)(Ae.l1,{enableReinitialize:!0,initialValues:Y,onSubmit:ne,validationSchema:Ce,validateOnChange:!1,children:({errors:u,handleChange:U,values:G})=>(0,e.jsxs)(t.lV,{children:[(0,e.jsx)(w.c,{children:(0,e.jsxs)(g.s,{direction:"column",alignItems:"stretch",gap:6,children:[A!=="create"&&(0,e.jsx)(W,{registrationToken:B}),(0,e.jsxs)(n.a,{children:[(0,e.jsx)(L.o,{variant:"beta",as:"h2",children:D({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})}),(0,e.jsx)(n.a,{paddingTop:4,children:(0,e.jsx)(g.s,{direction:"column",alignItems:"stretch",gap:1,children:(0,e.jsx)(y.x,{gap:5,children:ye.map(_e=>_e.map(x=>(0,e.jsx)(r.E,{...x.size,children:(0,e.jsx)(t.ah,{...x,disabled:H,error:u[x.name],onChange:U,value:G[x.name]})},x.name)))})})})]}),(0,e.jsxs)(n.a,{children:[(0,e.jsx)(L.o,{variant:"beta",as:"h2",children:D({id:"global.roles",defaultMessage:"User's role"})}),(0,e.jsx)(n.a,{paddingTop:4,children:(0,e.jsxs)(y.x,{gap:5,children:[(0,e.jsx)(r.E,{col:6,xs:12,children:(0,e.jsx)(Ee.S,{disabled:H,error:u.roles,onChange:U,value:G.roles})}),R.map(_e=>_e.map(x=>(0,e.jsx)(r.E,{...x.size,children:(0,e.jsx)(t.ah,{...x,disabled:H,onChange:U,value:G[x.name]})},x.name)))]})})]})]})}),(0,e.jsx)(oe.j,{startActions:(0,e.jsx)(m.$,{variant:"tertiary",onClick:_,type:"button",children:D({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:Ue})]})})]}):null};Me.propTypes={onToggle:l.func.isRequired,onSuccess:l.func.isRequired};const me=({pagination:a})=>(0,e.jsx)(n.a,{paddingTop:4,children:(0,e.jsxs)(g.s,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(t._u,{}),(0,e.jsx)(t.W7,{pagination:a})]})});me.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},me.propTypes={pagination:l.shape({page:l.number,pageCount:l.number,pageSize:l.number,total:l.number})};const Te=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],Le=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:a},{formatMessage:_}){return(0,e.jsx)(L.o,{textColor:"neutral800",children:a.map(A=>_({id:`Settings.permissions.users.${A.code}`,defaultMessage:A.name})).join(`,
`)})}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:a},{formatMessage:_}){return(0,e.jsxs)(g.s,{children:[(0,e.jsx)(t.nW,{isActive:a,variant:a?"success":"danger"}),(0,e.jsx)(L.o,{textColor:"neutral800",children:_({id:a?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:a?"Active":"Inactive"})})]})}}],pe=["ee","license-limit-info"],he=()=>{const{post:a}=(0,t.ry)(),{formatAPIError:_}=(0,t.wq)(),[A,ee]=(0,c.useState)(!1),V=(0,d.d4)(o.s),{allowedActions:{canCreate:$,canDelete:B,canRead:v}}=(0,t.ec)(V.settings.users),D=(0,N.useQueryClient)(),Q=(0,t.hN)(),{formatMessage:O}=(0,f.A)(),{search:i}=(0,ae.zy)();(0,t.L4)();const{users:z,pagination:R,isError:Y,isLoading:W,refetch:Z}=(0,le.u)(k.parse(i,{ignoreQueryPrefix:!0}),{cacheTime:0,enabled:v}),se=(0,F.p)(ue,async()=>(await s.e(5729).then(s.bind(s,5729))).CreateActionEE),ne=Le.map(E=>({...E,metadatas:{...E.metadatas,label:O(E.metadatas.label)}})),ie=O({id:"global.users",defaultMessage:"Users"}),te=()=>{ee(E=>!E)},H=(0,N.useMutation)(async E=>{await a("/admin/users/batch-delete",{ids:E})},{async onSuccess(){await Z(),await D.refetchQueries(pe)},onError(E){Q({type:"warning",message:{id:"notification.error",message:_(E),defaultMessage:"An error occured"}})}});return se?(0,e.jsxs)(p.g,{"aria-busy":W,children:[(0,e.jsx)(t.x7,{name:"Users"}),(0,e.jsx)(T.Q,{primaryAction:$&&(0,e.jsx)(se,{onClick:te}),title:ie,subtitle:O({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),v&&(0,e.jsx)(I.B,{startActions:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.q7,{label:O({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:ie})}),(0,e.jsx)(de.F,{displayedFilters:Te})]})}),(0,e.jsxs)(j.s,{canRead:v,children:[!v&&(0,e.jsx)(t.UW,{}),Y&&(0,e.jsx)("div",{children:"TODO: An error occurred"}),v&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.Ee,{contentType:"Users",isLoading:W,onConfirmDeleteAll:H.mutateAsync,onConfirmDelete:E=>H.mutateAsync([E]),headers:ne,rows:z,withBulkActions:!0,withMainAction:B,children:(0,e.jsx)(ce,{canDelete:B,headers:ne,rows:z,withBulkActions:!0,withMainAction:B})}),R&&(0,e.jsx)(me,{pagination:R})]})]}),A&&(0,e.jsx)(Me,{onSuccess:async()=>{await Z(),await D.refetchQueries(pe)},onToggle:te})]}):null},ve=()=>{const a=(0,F.p)(he,async()=>(await s.e(6551).then(s.bind(s,86551))).UserListPageEE);return a?(0,e.jsx)(a,{}):null},Re=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=(0,d.d4)(o.s);return(0,e.jsx)(t.kz,{permissions:a.settings.users.main,children:(0,e.jsx)(ve,{})})}},Symbol.toStringTag,{value:"Module"}))},72249:(J,M,s)=>{s.d(M,{M:()=>T,S:()=>w,a:()=>j});var e=s(92132),t=s(33544),d=s(54894),o=s(59057),c=s(88353),K=s(43739),n=s(95336),m=s(56445),y=s(90625),r=s(84795),C=s(74930),I=s(94929);const j=({children:g,target:h})=>{const S=(0,m.hN)(),{formatMessage:b}=(0,d.A)(),{copy:L}=(0,m.iD)(),k=b({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),f=async()=>{await L(h)&&S({type:"info",message:{id:"notification.link-copied"}})};return(0,e.jsx)(m.bQ,{endAction:(0,e.jsx)(c.K,{label:k,noBorder:!0,icon:(0,e.jsx)(y.A,{}),onClick:f}),title:h,titleEllipsis:!0,subtitle:g,icon:(0,e.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})};j.propTypes={children:t.oneOfType([t.element,t.string]).isRequired,target:t.string.isRequired};const T=({registrationToken:g})=>{const{formatMessage:h}=(0,d.A)(),S=`${window.location.origin}${(0,o.T)()}/auth/register?registrationToken=${g}`;return(0,e.jsx)(j,{target:S,children:h({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})};T.defaultProps={registrationToken:""},T.propTypes={registrationToken:t.string};const p=(0,I.i7)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,X=I.Ay.div`
  animation: ${p} 2s infinite linear;
`,re=()=>(0,e.jsx)(X,{children:(0,e.jsx)(r.A,{})}),oe=async()=>{const{get:g}=(0,m.GD)(),{data:h}=await g("/admin/roles");return h.data},w=({disabled:g,error:h,onChange:S,value:b})=>{const{status:L,data:k}=(0,C.useQuery)(["roles"],oe,{staleTime:5e4}),{formatMessage:f}=(0,d.A)(),N=h?f({id:h,defaultMessage:h}):"",ae=f({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),le=f({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),F=f({id:"app.components.Select.placeholder",defaultMessage:"Select"}),de=L==="loading"?(0,e.jsx)(re,{}):void 0;return(0,e.jsx)(K.l,{id:"roles",disabled:g,error:N,hint:le,label:ae,name:"roles",onChange:P=>{S({target:{name:"roles",value:P}})},placeholder:F,multi:!0,startIcon:de,value:b.map(P=>P.toString()),withTags:!0,required:!0,children:(k||[]).map(P=>(0,e.jsx)(n.c,{value:P.id.toString(),children:f({id:`global.${P.code}`,defaultMessage:P.name})},P.id))})};w.defaultProps={disabled:!1,error:void 0},w.propTypes={disabled:t.bool,error:t.string,onChange:t.func.isRequired,value:t.array.isRequired}},74773:(J,M,s)=>{s.d(M,{B:()=>d});var e=s(92132),t=s(83997);const d=({startActions:o,endActions:c})=>!o&&!c?null:(0,e.jsxs)(t.s,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(t.s,{gap:2,wrap:"wrap",children:o}),(0,e.jsx)(t.s,{gap:2,shrink:0,wrap:"wrap",children:c})]})},90532:(J,M,s)=>{s.d(M,{F:()=>y});var e=s(92132),t=s(21272),d=s(94061),o=s(85963),c=s(56445),K=s(28604),n=s(33544),m=s(54894);const y=({displayedFilters:r})=>{const[C,I]=(0,t.useState)(!1),{formatMessage:j}=(0,m.A)(),T=(0,t.useRef)(),p=()=>{I(X=>!X)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(d.a,{paddingTop:1,paddingBottom:1,children:[(0,e.jsx)(o.$,{variant:"tertiary",ref:T,startIcon:(0,e.jsx)(K.A,{}),onClick:p,size:"S",children:j({id:"app.utils.filters",defaultMessage:"Filters"})}),C&&(0,e.jsx)(c.LC,{displayedFilters:r,isVisible:C,onToggle:p,source:T})]}),(0,e.jsx)(c.cZ,{filtersSchema:r})]})};y.propTypes={displayedFilters:n.arrayOf(n.shape({name:n.string.isRequired,metadatas:n.shape({label:n.string}),fieldSchema:n.shape({type:n.string})})).isRequired}}}]);
