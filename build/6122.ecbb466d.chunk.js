"use strict";(self.webpackChunknassif_group_strapi=self.webpackChunknassif_group_strapi||[]).push([[6122],{8589:(j,_,s)=>{s.d(_,{u:()=>c});var e=s(21272),t=s(56445),a=s(74930);function c(d={},u={}){const{id:E="",...n}=d,{get:M}=(0,t.ry)(),{data:r,isError:B,isLoading:C,refetch:h}=(0,a.useQuery)(["users",E,n],async()=>{const{data:{data:g}}=await M(`/admin/users/${E}`,{params:n});return g},u);return{users:e.useMemo(()=>{let g=[];return r&&("results"in r?Array.isArray(r.results)&&(g=r.results):g=[r]),g},[r]),pagination:e.useMemo(()=>(r&&"pagination"in r)??null,[r]),isLoading:C,isError:B,refetch:h}}},25271:(j,_,s)=>{s.d(_,{a:()=>u,s:()=>c});var e=s(12083),t=s(56445);const a={firstname:e.Yj().trim().required(t.iW.required),lastname:e.Yj(),email:e.Yj().email(t.iW.email).lowercase().required(t.iW.required),username:e.Yj().nullable(),password:e.Yj().min(8,t.iW.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:e.Yj().min(8,t.iW.minLength).oneOf([e.KR("password"),null],"components.Input.error.password.noMatch").when("password",(E,n)=>E?n.required(t.iW.required):n)},c={...a,currentPassword:e.Yj().when(["password","confirmPassword"],(E,n,M)=>E||n?M.required(t.iW.required):M),preferedLanguage:e.Yj().nullable()},d={roles:e.YO().min(1,t.iW.required).required(t.iW.required)},u=e.Ik().shape({...a,isActive:e.lc(),...d})},46270:(j,_,s)=>{s.d(_,{A:()=>a});var e=s(92132);const t=c=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...c,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),a=t},72249:(j,_,s)=>{s.d(_,{M:()=>A,S:()=>W,a:()=>h});var e=s(92132),t=s(33544),a=s(54894),c=s(59057),d=s(88353),u=s(43739),E=s(95336),n=s(56445),M=s(90625),r=s(84795),B=s(74930),C=s(94929);const h=({children:p,target:l})=>{const T=(0,n.hN)(),{formatMessage:x}=(0,a.A)(),{copy:R}=(0,n.iD)(),K=x({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),P=async()=>{await R(l)&&T({type:"info",message:{id:"notification.link-copied"}})};return(0,e.jsx)(n.bQ,{endAction:(0,e.jsx)(d.K,{label:K,noBorder:!0,icon:(0,e.jsx)(M.A,{}),onClick:P}),title:l,titleEllipsis:!0,subtitle:p,icon:(0,e.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})};h.propTypes={children:t.oneOfType([t.element,t.string]).isRequired,target:t.string.isRequired};const A=({registrationToken:p})=>{const{formatMessage:l}=(0,a.A)(),T=`${window.location.origin}${(0,c.T)()}/auth/register?registrationToken=${p}`;return(0,e.jsx)(h,{target:T,children:l({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})};A.defaultProps={registrationToken:""},A.propTypes={registrationToken:t.string};const g=(0,C.i7)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,$=C.Ay.div`
  animation: ${g} 2s infinite linear;
`,b=()=>(0,e.jsx)($,{children:(0,e.jsx)(r.A,{})}),V=async()=>{const{get:p}=(0,n.GD)(),{data:l}=await p("/admin/roles");return l.data},W=({disabled:p,error:l,onChange:T,value:x})=>{const{status:R,data:K}=(0,B.useQuery)(["roles"],V,{staleTime:5e4}),{formatMessage:P}=(0,a.A)(),S=l?P({id:l,defaultMessage:l}):"",G=P({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),X=P({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),w=P({id:"app.components.Select.placeholder",defaultMessage:"Select"}),J=R==="loading"?(0,e.jsx)(b,{}):void 0;return(0,e.jsx)(u.l,{id:"roles",disabled:p,error:S,hint:X,label:G,name:"roles",onChange:D=>{T({target:{name:"roles",value:D}})},placeholder:w,multi:!0,startIcon:J,value:x.map(D=>D.toString()),withTags:!0,required:!0,children:(K||[]).map(D=>(0,e.jsx)(E.c,{value:D.id.toString(),children:P({id:`global.${D.code}`,defaultMessage:D.name})},D.id))})};W.defaultProps={disabled:!1,error:void 0},W.propTypes={disabled:t.bool,error:t.string,onChange:t.func.isRequired,value:t.array.isRequired}},86122:(j,_,s)=>{s.r(_),s.d(_,{default:()=>os});var e=s(92132),t=s(21272),a=s(56445),c=s(82437),d=s(17703),u=s(97927),E=s(94061),n=s(85963),M=s(90151),r=s(68074),B=s(4198),C=s(55356),h=s(38413),A=s(83997),g=s(30893),$=s(46270),b=s(54514),V=s(61535),W=s(2600),p=s(35223),l=s(79275),T=s(33544),x=s(54894),R=s(8589),K=s(59057),P=s(89565),S=s(72249),G=s(25271),X=s(74930),w=s(55151),J=s(79077),D=s(48940),_s=s(51187),cs=s(15126),Es=s(63299),ms=s(67014),gs=s(59080),us=s(14718),Ms=s(5790),ps=s(12083),Ps=s(41286),Ds=s(5409);const ts=async(v,i)=>{const{put:U}=(0,a.GD)(),{data:I}=await U(`/admin/users/${v}`,i);return I.data},ns=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]],k=["email","firstname","lastname","username","isActive","roles"],q=({canUpdate:v})=>{const{formatMessage:i}=(0,x.A)(),{params:{id:U}}=(0,d.W5)("/settings/users/:id"),{push:I}=(0,d.W6)(),{setUserDisplayName:z}=(0,a.Xe)(),f=(0,a.hN)(),{lockApp:H,unlockApp:Z}=(0,a.MA)(),ss=(0,K.p)(S.M,async()=>(await s.e(5227).then(s.bind(s,95227))).MagicLinkEE);(0,a.L4)();const{users:[N],isLoading:rs}=(0,R.u)({id:U},{cacheTime:0,onError(o){const{status:m}=o.response;m===403?(f({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),I("/")):f({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),is=async(o,m)=>{H();try{const O=await ts(U,p(o,"confirmPassword"));f({type:"success",message:i({id:"notification.success.saved",defaultMessage:"Saved"})});const y=a.j2.getUserInfo();if(U.toString()===y.id.toString()){a.j2.setUserInfo(O);const Y=W(o,"username")||(0,u.g)(o.firstname,o.lastname);z(Y)}m.setValues(l(o,k))}catch(O){const y=(0,P.f)(O.response.data),Y=Object.keys(y).reduce((F,L)=>(F[L]=y[L].id,F),{});m.setErrors(Y),f({type:"warning",message:W(O,"response.data.error.message","notification.error")})}Z()},es=rs||!ss,ds=es?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},Q=Object.keys(l(N,k)).reduce((o,m)=>m==="roles"?(o[m]=(N?.roles||[]).map(({id:O})=>O),o):(o[m]=N?.[m],o),{}),ls=Q.username||(0,u.g)(Q.firstname,Q.lastname),as=i(ds,{name:ls});return es?(0,e.jsxs)(h.g,{"aria-busy":"true",children:[(0,e.jsx)(a.x7,{name:"Users"}),(0,e.jsx)(C.Q,{primaryAction:(0,e.jsx)(n.$,{disabled:!0,startIcon:(0,e.jsx)(b.A,{}),type:"button",size:"L",children:i({id:"global.save",defaultMessage:"Save"})}),title:as,navigationAction:(0,e.jsx)(a.N_,{startIcon:(0,e.jsx)($.A,{}),to:"/settings/users?pageSize=10&page=1&sort=firstname",children:i({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsx)(B.s,{children:(0,e.jsx)(a.Bl,{})})]}):(0,e.jsxs)(h.g,{children:[(0,e.jsx)(a.x7,{name:"Users"}),(0,e.jsx)(V.l1,{onSubmit:is,initialValues:Q,validateOnChange:!1,validationSchema:G.a,children:({errors:o,values:m,handleChange:O,isSubmitting:y,dirty:Y})=>(0,e.jsxs)(a.lV,{children:[(0,e.jsx)(C.Q,{primaryAction:(0,e.jsx)(n.$,{disabled:y||!v?!0:!Y,startIcon:(0,e.jsx)(b.A,{}),loading:y,type:"submit",size:"L",children:i({id:"global.save",defaultMessage:"Save"})}),title:as,navigationAction:(0,e.jsx)(a.N_,{startIcon:(0,e.jsx)($.A,{}),to:"/settings/users?pageSize=10&page=1&sort=firstname",children:i({id:"global.back",defaultMessage:"Back"})})}),(0,e.jsxs)(B.s,{children:[N?.registrationToken&&(0,e.jsx)(E.a,{paddingBottom:6,children:(0,e.jsx)(ss,{registrationToken:N.registrationToken})}),(0,e.jsxs)(A.s,{direction:"column",alignItems:"stretch",gap:7,children:[(0,e.jsx)(E.a,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(A.s,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(g.o,{variant:"delta",as:"h2",children:i({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})}),(0,e.jsx)(M.x,{gap:5,children:ns.map(F=>F.map(L=>(0,e.jsx)(r.E,{...L.size,children:(0,e.jsx)(a.ah,{...L,disabled:!v,error:o[L.name],onChange:O,value:m[L.name]||""})},L.name)))})]})}),(0,e.jsx)(E.a,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,children:(0,e.jsxs)(A.s,{direction:"column",alignItems:"stretch",gap:4,children:[(0,e.jsx)(g.o,{variant:"delta",as:"h2",children:i({id:"global.roles",defaultMessage:"User's role"})}),(0,e.jsx)(M.x,{gap:5,children:(0,e.jsx)(r.E,{col:6,xs:12,children:(0,e.jsx)(S.S,{disabled:!v,error:o.roles,onChange:O,value:m.roles})})})]})})]})]})]})})]})};q.propTypes={canUpdate:T.bool.isRequired};const os=()=>{const v=(0,a.hN)(),i=(0,c.d4)(u.s),U=t.useMemo(()=>({read:i.settings.users.read,update:i.settings.users.update}),[i.settings.users]),{isLoading:I,allowedActions:{canRead:z,canUpdate:f}}=(0,a.ec)(U),{state:H}=(0,d.zy)(),Z=H?.from??"/";return(0,t.useEffect)(()=>{I||!z&&!f&&v({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[I,z,f,v]),I?(0,e.jsx)(a.Bl,{}):!z&&!f?(0,e.jsx)(d.rd,{to:Z}):(0,e.jsx)(q,{canUpdate:f})}},89565:(j,_,s)=>{s.d(_,{f:()=>e});const e=({data:t})=>{try{return Object.keys(t).reduce((a,c)=>{const d=t[c][0];return a[c]={id:d,defaultMessage:d},a},{})}catch{return{}}}}}]);
